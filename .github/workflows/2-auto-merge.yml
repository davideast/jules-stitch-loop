name: ‚ö° Auto-Merge Keeper
on:
  workflow_run:
    workflows: ["üõ°Ô∏è Loop Integrity Check"]
    types: [completed]
jobs:
  merge:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    permissions:
      contents: write
      pull-requests: write
    steps:
      - name: Merge
        # Using GH_PAT ensures the merge triggers the next 'on: push' workflow
        env:
          GH_TOKEN: ${{ secrets.GH_PAT }}
        run: |
          PR=$(gh pr list --head "${{ github.event.workflow_run.head_branch }}" --json number --jq '.[0].number')
          if [ -n "$PR" ]; then gh pr merge $PR --squash --auto --delete-branch; fi